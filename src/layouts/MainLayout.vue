<template>
  <div class="q-pa-md">
    <q-layout view="hHh Lpr fFf">
      <q-header
        elevated
        :class="$q.dark.isActive ? 'bg-secondary' : 'bg-black'"
      >
        <q-toolbar>
          <q-btn flat @click="drawer = !drawer" round dense icon="menu" />
          <q-toolbar-title>Malware</q-toolbar-title>
        </q-toolbar>
      </q-header>

      <q-drawer
        v-model="drawer"
        show-if-above
        :mini="miniState"
        @mouseover="miniState = false"
        @mouseout="miniState = true"
        :width="200"
        :breakpoint="500"
        bordered
        :class="$q.dark.isActive ? 'bg-grey-9' : 'bg-grey-3'"
      >
        <q-list padding>
          <q-item active clickable v-ripple>
            <q-item-section avatar>
              <q-icon name="home" />
            </q-item-section>

            <q-item-section> Home </q-item-section>
          </q-item>

          <q-item clickable v-ripple>
            <q-item-section avatar>
              <q-icon name="history" />
            </q-item-section>

            <q-item-section> History </q-item-section>
          </q-item>
        </q-list>
      </q-drawer>

      <q-page-container>
        <q-page padding>
          <q-card class="my-card">
            <q-card-section>
              <q-toolbar-title>Welcome Malware Detection</q-toolbar-title>
            </q-card-section>
          </q-card>
          <q-card>
            <div class="q-pa-md q-my-md">
              <q-form @submit="onSubmit" class="q-gutter-md">
                <q-file
                  name="cover_files"
                  v-model="files"
                  filled
                  multiple
                  use-chips
                  icon ="cloud_upload"
                  label="Upload Malware Files"
                />

                <div>
                  <q-btn label="Submit" type="submit" color="primary" />
                </div>
              </q-form>

              <q-card
                v-if="submitted"
                flat
                bordered
                class="q-mt-md"
                :class="$q.dark.isActive ? 'bg-red' : 'bg-white'"
              >
                <template v-if="submitEmpty">
                  <q-card-section>
                    Submitted form contains empty Data.
                  </q-card-section>
                </template>
                <q-card-section v-else>
                  Submitted form contains the following Data
                </q-card-section>
                <q-separator class="bg-blue" />
                <q-card-section class="row q-gutter-sm items-center">
                  <div
                    v-for="(item, index) in submitResult"
                    :key="index"
                    class="q-px-sm q-py-xs bg-grey-8 text-white rounded-borders text-center text-no-wrap"
                  >
                    {{ item.name }} = {{ item.value }}
                  </div>
                </q-card-section>
              </q-card>
            </div>
          </q-card>
        </q-page>
      </q-page-container>
    </q-layout>
  </div>
</template>

<script setup>
import { ref } from "vue";
import { useQuasar } from "quasar";
import axios from "axios";
const drawer = ref(false);
const miniState = ref(true);
const $q = useQuasar();

const files = ref(null);
const submitted = ref(false);
const submitEmpty = ref(false);
const submitResult = ref([]);

const onSubmit = () => {
  if (files.value && files.value.length > 0) {
    const formData = new FormData();
    files.value.forEach((file) => {
      formData.append("file", file);
    });

    formData.append("key", "value");

    const result = [];
    for (const [key, value] of formData.entries()) {
      if (typeof value === "string") {
        result.push({ name: key, value: value });
      } else {
        result.push({ name: key, value: value.name });
      }
    }

    submitted.value = true;
    submitResult.value = result;
    submitEmpty.value = false;
  } else {
    submitted.value = true;
    submitResult.value = [];
    submitEmpty.value = true;
  }
};
</script>

<style>
body {
  overflow: hidden;
}
</style>
